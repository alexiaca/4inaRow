/*
* Socket.IO.js build:0.9.16, development. 
* Copyright(c) 2011 LearnBoost <dev@learnboost.com>
* MIT Licensed 
*/

var io="undefined"==typeof module?{}:module.exports;!function(){var a,b,c,va,wa,Zb,$b,oc,pc,qc,md,nd,Gd,Hd,Id,Xd,Yd,Zd,we,xe,Le,Me,Ne,Ze,$e,_e,af;function xa(){}function _b(t,e){this.socket=t,this.sessid=e}function rc(t){if(this.options={port:80,secure:!1,document:"document"in qc&&document,resource:"socket.io",transports:pc.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},pc.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||pc.util.ua.hasCORS)){var e=this;pc.util.on(qc,"beforeunload",function(){e.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function sc(){}function od(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new pd(this,"json"),this.ackPackets=0,this.acks={}}function pd(t,e){this.namespace=t,this.name=e}function Jd(t){Hd.Transport.apply(this,arguments)}function $d(t){t&&(Yd.Transport.apply(this,arguments),this.sendBuffer=[])}function _d(){}function ye(t){xe.Transport.XHR.apply(this,arguments)}function Oe(){Me.Transport.XHR.apply(this,arguments)}function Pe(){}function bf(t){$e.Transport["xhr-polling"].apply(this,arguments),this.index=$e.j.length;var e=this;$e.j.push(function(t){e._(t)})}a="object"==typeof module?module.exports:this.io={},b=this,c=a,c.version="0.9.16",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(t,e){var n,o,i=c.util.parseUri(t);b&&b.location&&(i.protocol=i.protocol||b.location.protocol.slice(0,-1),i.host=i.host||(b.document?b.document.domain:b.location.hostname),i.port=i.port||b.location.port),n=c.util.uniqueUri(i);var r={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};return c.util.merge(r,e),!r["force new connection"]&&c.sockets[n]||(o=new c.Socket(r)),!r["force new connection"]&&o&&(c.sockets[n]=o),(o=o||c.sockets[n]).of(1<i.path.length?i.path:"")},function(t,i){var c=t.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(t){for(var e=r.exec(t||""),n={},o=14;o--;)n[s[o]]=e[o]||"";return n},c.uniqueUri=function(t){var e=t.protocol,n=t.host,o=t.port;return"document"in i?(n=n||document.domain,o=o||("https"==e&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",o||"https"!=e||(o=443)),(e||"http")+"://"+n+":"+(o||80)},c.query=function(t,e){var n=c.chunkQuery(t||""),o=[];for(var i in c.merge(n,c.chunkQuery(e||"")),n)n.hasOwnProperty(i)&&o.push(i+"="+n[i]);return o.length?"?"+o.join("&"):""};var e=!(c.chunkQuery=function(t){for(var e,n={},o=t.split("&"),i=0,r=o.length;i<r;++i)(e=o[i].split("="))[0]&&(n[e[0]]=e[1]);return n});c.load=function(t){if("document"in i&&"complete"===document.readyState||e)return t();c.on(i,"load",t,!1)},c.on=function(t,e,n,o){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,o)},c.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||c.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&c.load(function(){e=!0}),c.defer=function(t){if(!c.ua.webkit||"undefined"!=typeof importScripts)return t();c.load(function(){setTimeout(t,100)})},c.merge=function(t,e,n,o){var i,r=o||[],s=void 0===n?2:n;for(i in e)e.hasOwnProperty(i)&&c.indexOf(r,i)<0&&("object"==typeof t[i]&&s?c.merge(t[i],e[i],s-1,r):(t[i]=e[i],r.push(e[i])));return t},c.mixin=function(t,e){c.merge(t.prototype,e.prototype)},c.inherit=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},c.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},c.intersect=function(t,e){for(var n=[],o=t.length>e.length?t:e,i=t.length>e.length?e:t,r=0,s=i.length;r<s;r++)~c.indexOf(o,i[r])&&n.push(i[r]);return n},c.indexOf=function(t,e,n){var o=t.length;for(n=n<0?n+o<0?0:n+o:n||0;n<o&&t[n]!==e;n++);return o<=n?-1:n},c.toArray=function(t){for(var e=[],n=0,o=t.length;n<o;n++)e.push(t[n]);return e},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(t){return!1}return null!=t.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,this),va=void 0!==io?io:module.exports,wa=void 0!==io?io:module.parent.exports,(va.EventEmitter=xa).prototype.addListener=xa.prototype.on=function(t,e){return this.$events||(this.$events={}),this.$events[t]?wa.util.isArray(this.$events[t])?this.$events[t].push(e):this.$events[t]=[this.$events[t],e]:this.$events[t]=e,this},xa.prototype.once=function(t,e){var n=this;function o(){n.removeListener(t,o),e.apply(this,arguments)}return o.listener=e,this.on(t,o),this},xa.prototype.removeListener=function(t,e){if(this.$events&&this.$events[t]){var n=this.$events[t];if(wa.util.isArray(n)){for(var o=-1,i=0,r=n.length;i<r;i++)if(n[i]===e||n[i].listener&&n[i].listener===e){o=i;break}if(o<0)return this;n.splice(o,1),n.length||delete this.$events[t]}else(n===e||n.listener&&n.listener===e)&&delete this.$events[t]}return this},xa.prototype.removeAllListeners=function(t){return void 0===t?this.$events={}:this.$events&&this.$events[t]&&(this.$events[t]=null),this},xa.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),wa.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},xa.prototype.emit=function(t){if(!this.$events)return!1;var e=this.$events[t];if(!e)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof e)e.apply(this,n);else{if(!wa.util.isArray(e))return!1;for(var o=e.slice(),i=0,r=o.length;i<r;i++)o[i].apply(this,n)}return!0},function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(t){return t<10?"0"+t:t}function date(t,e){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,o,i,r,s,c=gap,a=e[t];switch(a instanceof Date&&(a=date(t)),"function"==typeof rep&&(a=rep.call(e,t,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(a)){for(r=a.length,n=0;n<r;n+=1)s[n]=str(n,a)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+c+"]":"["+s.join(",")+"]",gap=c,i}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;n<r;n+=1)"string"==typeof rep[n]&&(i=str(o=rep[n],a))&&s.push(quote(o)+(gap?": ":":")+i);else for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i=str(o,a))&&s.push(quote(o)+(gap?": ":":")+i);return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+c+"}":"{"+s.join(",")+"}",gap=c,i}}JSON.stringify=function(t,e,n){var o;if(indent=gap="","number"==typeof n)for(o=0;o<n;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if((rep=e)&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})},JSON.parse=function(text,reviver){var j;function walk(t,e){var n,o,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(void 0!==(o=walk(i,n))?i[n]=o:delete i[n]);return reviver.call(t,e,i)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var i=t.parser={},u=i.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],h=i.reasons=["transport not supported","client not handshaken","unauthorized"],d=i.advice=["reconnect"],l=e.JSON,f=e.util.indexOf;i.encodePacket=function(t){var e=f(u,t.type),n=t.id||"",o=t.endpoint||"",i=t.ack,r=null;switch(t.type){case"error":var s=t.reason?f(h,t.reason):"",c=t.advice?f(d,t.advice):"";""===s&&""===c||(r=s+(""!==c?"+"+c:""));break;case"message":""!==t.data&&(r=t.data);break;case"event":var a={name:t.name};t.args&&t.args.length&&(a.args=t.args),r=l.stringify(a);break;case"json":r=l.stringify(t.data);break;case"connect":t.qs&&(r=t.qs);break;case"ack":r=t.ackId+(t.args&&t.args.length?"+"+l.stringify(t.args):"")}var p=[e,n+("data"==i?"+":""),o];return null!=r&&p.push(r),p.join(":")},i.encodePayload=function(t){var e="";if(1==t.length)return t[0];for(var n=0,o=t.length;n<o;n++){e+="�"+t[n].length+"�"+t[n]}return e};var r=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;i.decodePacket=function(t){if(!(o=t.match(r)))return{};var e=o[2]||"",n=(t=o[5]||"",{type:u[o[1]],endpoint:o[4]||""});switch(e&&(n.id=e,o[3]?n.ack="data":n.ack=!0),n.type){case"error":var o=t.split("+");n.reason=h[o[0]]||"",n.advice=d[o[1]]||"";break;case"message":n.data=t||"";break;case"event":try{var i=l.parse(t);n.name=i.name,n.args=i.args}catch(t){}n.args=n.args||[];break;case"json":try{n.data=l.parse(t)}catch(t){}break;case"connect":n.qs=t||"";break;case"ack":if((o=t.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=o[1],n.args=[],o[3]))try{n.args=o[3]?l.parse(o[3]):[]}catch(t){}}return n},i.decodePayload=function(t){if("�"!=t.charAt(0))return[i.decodePacket(t)];for(var e=[],n=1,o="";n<t.length;n++)"�"==t.charAt(n)?(e.push(i.decodePacket(t.substr(n+1).substr(0,o))),n+=Number(o)+1,o=""):o+=t.charAt(n);return e}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),Zb=void 0!==io?io:module.exports,$b=void 0!==io?io:module.parent.exports,Zb.Transport=_b,$b.util.mixin(_b,$b.EventEmitter),_b.prototype.heartbeats=function(){return!0},_b.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t){var e=$b.parser.decodePayload(t);if(e&&e.length)for(var n=0,o=e.length;n<o;n++)this.onPacket(e[n])}return this},_b.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},_b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},_b.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},_b.prototype.onConnect=function(){return this.socket.onConnect(),this},_b.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},_b.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},_b.prototype.packet=function(t){this.send($b.parser.encodePacket(t))},_b.prototype.onHeartbeat=function(t){this.packet({type:"heartbeat"})},_b.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},_b.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},_b.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+$b.protocol+"/"+this.name+"/"+this.sessid},_b.prototype.ready=function(t,e){e.call(this)},oc=void 0!==io?io:module.exports,pc=void 0!==io?io:module.parent.exports,qc=this,oc.Socket=rc,pc.util.mixin(rc,pc.EventEmitter),rc.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new pc.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},rc.prototype.publish=function(){var t;for(var e in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e)).$emit.apply(t,arguments)},rc.prototype.handshake=function(e){var n=this,t=this.options;function o(t){t instanceof Error?(n.connecting=!1,n.onError(t.message)):e.apply(null,t.split(":"))}var i=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,pc.protocol,pc.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!pc.util.ua.hasCORS){var r=document.getElementsByTagName("script")[0],s=document.createElement("script");s.src=i+"&jsonp="+pc.j.length,r.parentNode.insertBefore(s,r),pc.j.push(function(t){o(t),s.parentNode.removeChild(s)})}else{var c=pc.util.request();c.open("GET",i,!0),this.isXDomain()&&(c.withCredentials=!0),c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=sc,200==c.status?o(c.responseText):403==c.status?n.onError(c.responseText):(n.connecting=!1,n.reconnecting||n.onError(c.responseText)))},c.send(null)}},rc.prototype.getTransport=function(t){for(var e,n=t||this.transports,o=0;e=n[o];o++)if(pc.Transport[e]&&pc.Transport[e].check(this)&&(!this.isXDomain()||pc.Transport[e].xdomainCheck(this)))return new pc.Transport[e](this,this.sessionid);return null},rc.prototype.connect=function(i){if(this.connecting)return this;var r=this;return r.connecting=!0,this.handshake(function(t,e,n,o){r.sessionid=t,r.closeTimeout=1e3*n,r.heartbeatTimeout=1e3*e,r.transports||(r.transports=r.origTransports=o?pc.util.intersect(o.split(","),r.options.transports):r.options.transports),r.setHeartbeatTimeout(),function e(t){if(r.transport&&r.transport.clearTimeouts(),r.transport=r.getTransport(t),!r.transport)return r.publish("connect_failed");r.transport.ready(r,function(){r.connecting=!0,r.publish("connecting",r.transport.name),r.transport.open(),r.options["connect timeout"]&&(r.connectTimeoutTimer=setTimeout(function(){if(!r.connected&&(r.connecting=!1,r.options["try multiple transports"])){for(var t=r.transports;0<t.length&&t.splice(0,1)[0]!=r.transport.name;);t.length?e(t):r.publish("connect_failed")}},r.options["connect timeout"]))})}(r.transports),r.once("connect",function(){clearTimeout(r.connectTimeoutTimer),i&&"function"==typeof i&&i()})}),this},rc.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},rc.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},rc.prototype.setBuffer=function(t){!(this.doBuffer=t)&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},rc.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},rc.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},rc.prototype.disconnectSync=function(){var t=pc.util.request(),e=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,pc.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",e,!1),t.send(null),this.onDisconnect("booted")},rc.prototype.isXDomain=function(){var t=qc.location.port||("https:"==qc.location.protocol?443:80);return this.options.host!==qc.location.hostname||this.options.port!=t},rc.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},rc.prototype.onOpen=function(){this.open=!0},rc.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},rc.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},rc.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},rc.prototype.onDisconnect=function(t){var e=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||n)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},rc.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],o=this.options["reconnection limit"];function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",r),e.removeListener("connect",r),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=n}function r(){if(e.reconnecting)return e.connected?i():e.connecting&&e.reconnecting?e.reconnectionTimer=setTimeout(r,1e3):void(e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",r),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<o&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(r,e.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(r,this.reconnectionDelay),this.on("connect",r)},md=void 0!==io?io:module.exports,nd=void 0!==io?io:module.parent.exports,md.SocketNamespace=od,nd.util.mixin(od,nd.EventEmitter),od.prototype.$emit=nd.EventEmitter.prototype.emit,od.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},od.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},od.prototype.send=function(t,e){var n={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=e),this.packet(n)},od.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),n=e[e.length-1],o={type:"event",name:t};return"function"==typeof n&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=n,e=e.slice(0,e.length-1)),o.args=e,this.packet(o)},od.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},od.prototype.onPacket=function(t){var e=this;function n(){e.packet({type:"ack",args:nd.util.toArray(arguments),ackId:t.id})}switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var o=["message",t.data];"data"==t.ack?o.push(n):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,o);break;case"event":o=[t.name].concat(t.args),"data"==t.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},pd.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},pd.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)},Gd=void 0!==io?io.Transport:module.exports,Hd=void 0!==io?io:module.parent.exports,Id=this,Gd.websocket=Jd,Hd.util.inherit(Jd,Hd.Transport),Jd.prototype.name="websocket",Jd.prototype.open=function(){var t,e=Hd.util.query(this.socket.options.query),n=this;return t=t||Id.MozWebSocket||Id.WebSocket,this.websocket=new t(this.prepareUrl()+e),this.websocket.onopen=function(){n.onOpen(),n.socket.setBuffer(!1)},this.websocket.onmessage=function(t){n.onData(t.data)},this.websocket.onclose=function(){n.onClose(),n.socket.setBuffer(!0)},this.websocket.onerror=function(t){n.onError(t)},this},Jd.prototype.send=Hd.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},Jd.prototype.payload=function(t){for(var e=0,n=t.length;e<n;e++)this.packet(t[e]);return this},Jd.prototype.close=function(){return this.websocket.close(),this},Jd.prototype.onError=function(t){this.socket.onError(t)},Jd.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},Jd.check=function(){return"WebSocket"in Id&&!("__addTask"in WebSocket)||"MozWebSocket"in Id},Jd.xdomainCheck=function(){return!0},Hd.transports.push("websocket"),Xd=void 0!==io?io.Transport:module.exports,Yd=void 0!==io?io:module.parent.exports,Zd=this,Xd.XHR=$d,Yd.util.inherit($d,Yd.Transport),$d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},$d.prototype.payload=function(t){for(var e=[],n=0,o=t.length;n<o;n++)e.push(Yd.parser.encodePacket(t[n]));this.send(Yd.parser.encodePayload(e))},$d.prototype.send=function(t){return this.post(t),this},$d.prototype.post=function(t){var e=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),Zd.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=_d,e.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=_d,e.posting=!1,200==this.status?e.socket.setBuffer(!1):e.onClose())},this.sendXHR.send(t)},$d.prototype.close=function(){return this.onClose(),this},$d.prototype.request=function(t){var e=Yd.util.request(this.socket.isXDomain()),n=Yd.util.query(this.socket.options.query,"t="+ +new Date);if(e.open(t||"GET",this.prepareUrl()+n,!0),"POST"==t)try{e.setRequestHeader?e.setRequestHeader("Content-type","text/plain;charset=UTF-8"):e.contentType="text/plain"}catch(t){}return e},$d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},$d.check=function(t,e){try{var n=Yd.util.request(e),o=Zd.XDomainRequest&&n instanceof XDomainRequest,i=t&&t.options&&t.options.secure?"https:":"http:",r=Zd.location&&i!=Zd.location.protocol;if(n&&(!o||!r))return!0}catch(t){}return!1},$d.xdomainCheck=function(t){return $d.check(t,!0)},we=void 0!==io?io.Transport:module.exports,xe=void 0!==io?io:module.parent.exports,we.htmlfile=ye,xe.util.inherit(ye,xe.Transport.XHR),ye.prototype.name="htmlfile",ye.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close();var t=(this.doc.parentWindow.s=this).doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var e=this,n=xe.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+n,xe.util.on(window,"unload",function(){e.destroy()})},ye.prototype._=function(t,e){t=t.replace(/\\\//g,"/"),this.onData(t);try{var n=e.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(t){}},ye.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},ye.prototype.close=function(){return this.destroy(),xe.Transport.XHR.prototype.close.call(this)},ye.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new(window[["Active"].concat("Object").join("X")])("htmlfile")&&xe.Transport.XHR.check(t)}catch(t){}return!1},ye.xdomainCheck=function(){return!1},xe.transports.push("htmlfile"),Le=void 0!==io?io.Transport:module.exports,Me=void 0!==io?io:module.parent.exports,Ne=this,Le["xhr-polling"]=Oe,Me.util.inherit(Oe,Me.Transport.XHR),Me.util.merge(Oe,Me.Transport.XHR),Oe.prototype.name="xhr-polling",Oe.prototype.heartbeats=function(){return!1},Oe.prototype.open=function(){return Me.Transport.XHR.prototype.open.call(this),!1},Oe.prototype.get=function(){if(this.isOpen){var t=this;this.xhr=this.request(),Ne.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=Pe,this.onerror=Pe,t.retryCounter=1,t.onData(this.responseText),t.get()},this.xhr.onerror=function(){t.retryCounter++,!t.retryCounter||3<t.retryCounter?t.onClose():t.get()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=Pe,200==this.status?(t.onData(this.responseText),t.get()):t.onClose())},this.xhr.send(null)}},Oe.prototype.onClose=function(){if(Me.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=Pe;try{this.xhr.abort()}catch(t){}this.xhr=null}},Oe.prototype.ready=function(t,e){var n=this;Me.util.defer(function(){e.call(n)})},Me.transports.push("xhr-polling"),Ze=void 0!==io?io.Transport:module.exports,$e=void 0!==io?io:module.parent.exports,_e=this,af=_e.document&&"MozAppearance"in _e.document.documentElement.style,Ze["jsonp-polling"]=bf,$e.util.inherit(bf,$e.Transport["xhr-polling"]),bf.prototype.name="jsonp-polling",bf.prototype.post=function(t){var e=this,n=$e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var o,i=document.createElement("form"),r=document.createElement("textarea"),s=this.iframeId="socketio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.display="none",i.target=s,i.method="POST",i.setAttribute("accept-charset","utf-8"),r.name="d",i.appendChild(r),document.body.appendChild(i),this.form=i,this.area=r}function c(){a(),e.socket.setBuffer(!1)}function a(){e.iframe&&e.form.removeChild(e.iframe);try{o=document.createElement('<iframe name="'+e.iframeId+'">')}catch(t){(o=document.createElement("iframe")).name=e.iframeId}o.id=e.iframeId,e.form.appendChild(o),e.iframe=o}this.form.action=this.prepareUrl()+n,a(),this.area.value=$e.JSON.stringify(t);try{this.form.submit()}catch(t){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},bf.prototype.get=function(){var t=this,e=document.createElement("script"),n=$e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.prepareUrl()+n,e.onerror=function(){t.onClose()};var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o),this.script=e,af&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},bf.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},bf.prototype.ready=function(t,e){var n=this;if(!af)return e.call(this);$e.util.load(function(){e.call(n)})},bf.check=function(){return"document"in _e},bf.xdomainCheck=function(){return!0},$e.transports.push("jsonp-polling"),"function"==typeof define&&define.amd&&define([],function(){return io})}();