/*
* grrd's 4 in a Row
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/
!function(){"use strict";function a(a,b,c,d){G[b].beginPath(),G[b].arc(Z/2,a,Z/2*.85,0,2*Math.PI,!1),G[b].fillStyle=c,G[b].fill(),G[b].lineWidth=Z/20,G[b].strokeStyle=d,G[b].stroke()}function b(){var b,c,d=$(window).height(),e=$(window).width();d>e?(Z=Math.min((e-50)/7,(d-140)/6),_=Math.max(6*Z*.85,d-190),ma.attr("style","width:100%;"),$(".li_port").attr("style","height:"+($(window).height()-$(window).width()/3-130)/7+"px;"),$(".li_padd").attr("style","padding-top:"+($(window).height()-$(window).width()/3-270)/14+"px;"),$("#page_landscape").attr("style","display:none;"),$("#page_portrait").attr("style","display:inline;"),$("#indicator_landscape_l").attr("style","display:none;"),$("#indicator_landscape_r").attr("style","display:none;"),$("#indicator_portrait").attr("style","display:block;"),$("#popupDialog_landscape").attr("style","display:none;"),$("#popupDialog_portrait").attr("style","display:block;"),$("#popupSettings_portrait").attr("style","display:block;"),$("#popupSettings_landscape").attr("style","display:none;"),$("#popupSettings_col_b").appendTo("#popupSettings_portrait"),$("#printMessage").attr("style","display:block;")):(Z=Math.min((e-140-40)/7,(d-20)/6),_=Math.max(6*Z*.85,d-95),ma.attr("style","width:"+.6*$(window).width()+"px;"),$("#blankspace").attr("style","height:"+($(window).height()/4-$(window).width()/20)+"px;"),$("#page_landscape").attr("style","display:inline;"),$("#page_portrait").attr("style","display:none;"),$("#indicator_landscape_l").attr("style","display:inline;"),$("#indicator_landscape_r").attr("style","display:inline;"),$("#indicator_portrait").attr("style","display:none;"),$("#popupDialog_landscape").attr("style","display:block;"),$("#popupDialog_portrait").attr("style","display:none;"),$("#popupSettings_portrait").attr("style","display:none;"),$("#popupSettings_landscape").attr("style","display:block;"),$("#popupSettings_col_b").appendTo("#popupSettings_landscape_b"),$("#printMessage").attr("style","display:inline;"));var f=Math.max((d-e/3)/7,0);for($(".a_land").attr("style","width:"+(e/5-8)+"px;padding-bottom:"+f/2+"px;"),$(".img_land").attr("style","padding-top:"+f+"px;padding-bottom:"+f/2+"px;width: 100%;min-width: 40px;max-width: 108px;"),b=0;b<E.length;b+=1)document.getElementById(E[b]).width=Z,document.getElementById(E[b]).height=_;for(c=0;c<H[0].length&&void 0!==G[c];c+=1)for(b=0;b<H.length;b+=1)G[c].beginPath(),G[c].arc(Z/2,(H.length-b-.5)*Z*.85,Z/2*.7,0,2*Math.PI,!1),G[c].lineWidth=Z/10,G[c].strokeStyle="#212121",G[c].stroke(),G[c].beginPath(),G[c].arc(Z/2,(H.length-b-.5)*Z*.85,Z/2*.7,1.8*Math.PI,.8*Math.PI,!1),G[c].lineWidth=F[c].width/10,G[c].strokeStyle="grey",G[c].stroke();for(c=0;c<H[0].length&&void 0!==G[c];c+=1){for(G[c].save(),G[c].beginPath(),b=0;b<H.length;b+=1)G[c].arc(Z/2,(H.length-b-.5)*Z*.85,Z/2*.7,0,2*Math.PI,!1);G[c].clip(),G[c].clearRect(0,0,Z,_)}for(b=0;b<H.length;b+=1)for(c=0;c<H[b].length;c+=1)void 0!==H[b][c]&&a((H.length-b-.5)*Z*.85,c,qa[H[b][c]],ra[H[b][c]]);D&&(Y=Y/X*(H.length-R-.5)*Z*.85,X=(H.length-R-.5)*Z*.85)}function c(){var a,c;for(Ba=0,Aa=null,a=0;a<H.length;a+=1)for(c=0;c<H[a].length;c+=1)H[a][c]=void 0,0===a&&G[c].clearRect(0,0,Z,_);b()}function d(){$("#P1light").attr("src",ua[ta]),$("#P2light").attr("src",va[1-ta]),$("#P1light2").attr("src",ua[ta]),$("#P2light2").attr("src",va[1-ta])}function e(){ga="2player",ia?($("#P1icon").attr("src",ka.attr("src")),$("#P1icon2").attr("src",ka.attr("src"))):($("#P1icon").attr("src","Images/player.png"),$("#P1icon2").attr("src","Images/player.png")),N=ja?la.val():navigator.mozL10n.get("lbplayer1"),O=navigator.mozL10n.get("lbplayer2"),$("#P1name").html(N),$("#P1name2").html(N),$("#P2name").html(O),$("#P2name2").html(O),$("#P2icon").attr("src","Images/player.png"),$("#P2icon2").attr("src","Images/player.png"),d(),Ca=!1,$.mobile.changePage("#game",{transition:"slide"})}function f(a,b){Ca||(b+2e3>(new Date).getTime()&&D?window.requestAnimFrame(function(){f(a,b)}):(wa+=1,$("#printMessage").html(a),1===wa?$("#printSpiele").html(wa+" "+navigator.mozL10n.get("lbgame")):$("#printSpiele").html(wa+" "+navigator.mozL10n.get("lbgames")),$("#printScore1a").html(N),$("#printScore2a").html(O),$("#printScore1b").html(xa[0]),$("#printScore2b").html(xa[1]),$.mobile.changePage("#popupDialog",{transition:"pop",role:"dialog"}),c(),ta=wa%2!==0?1:0,d(),D=!1))}function g(b,c,d,e){var f;if(!Ca)if(6>d&&e+250<(new Date).getTime()&&D){for(d+=1,e=(new Date).getTime(),f=0;4>f;f+=1)d%2!==0?a((H.length-b[f]-.5)*Z*.85,c[f],sa[ta],"white"):a((H.length-b[f]-.5)*Z*.85,c[f],qa[ta],"white");window.requestAnimFrame(function(){g(b,c,d,e)})}else 6>d&&D&&window.requestAnimFrame(function(){g(b,c,d,e)})}function h(){D=!0;var a=ea.slice(),b=fa.slice();g(a,b,0,(new Date).getTime())}function i(a,b,c,d,e,f){var g;if(a+3*c<H.length&&b+3*d<H[a].length&&a+3*c>=0&&b+3*d>=0)for(g=0;4>g;g+=1)H[a+g*c][b+g*d]===e?(ea[g]=a+g*c,fa[g]=b+g*d,3===g&&(U=!0,f&&h(),g=5)):g=5}function j(a,b){for(U=!1,R=0;R<H.length;R+=1)for(Q=0;Q<H[R].length;Q+=1)i(R,Q,1,0,a,b),i(R,Q,0,1,a,b),i(R,Q,1,1,a,b),i(R,Q,1,-1,a,b);for(V=!1,Q=0;Q<H[0].length;Q+=1)void 0===H[H.length-1][Q]&&(V=!0)}function k(b,c,e){var g,h,i,l;D&&(g=new Date,h=g.getTime(),i=h-b,l=_*i/1e3,X>c?(c=Math.min(X,c+l),b=h,G[e].clearRect(0,0,Z,X+Z/2*.85),a(c,e,qa[ta],ra[ta]),window.requestAnimFrame(function(){k(b,c,e)})):(ha&&document.getElementById("click_sound").play(),D=!1,j(ta,!0),U?(xa[ta]=xa[ta]+1,ha&&document.getElementById("ding_sound").play(),0===ta?f(N+" "+navigator.mozL10n.get("lbwin"),(new Date).getTime()):f(O+" "+navigator.mozL10n.get("lbwin"),(new Date).getTime())):V?(ta=1-ta,d(),"2player"!==ga&&"online"!==ga&&1===ta&&w()):f(navigator.mozL10n.get("lbdraw"),(new Date).getTime())))}function l(a){var b,c;if(!(Da&&(Da=!1,"online"===ga&&(0===ta&&"0"===ba.role||1===ta&&"1"===ba.role))||D))for(Ba+=1,R=0,X=0;R<H.length&&0===X;){if(void 0===H[R][a]){D=!0,H[R][a]=ta,X=(H.length-R-.5)*Z*.85,b=new Date,c=b.getTime(),Y=-30,k(c,Y,a);break}R+=1}}function m(){$.mobile.changePage("#popupOnline",{transition:"pop",role:"dialog"}),$("#btonline").addClass("ui-disabled"),$("#btonline2").addClass("ui-disabled"),za?aa.socket.reconnect():(aa=io.connect("http://grrds4inarow.nodejitsu.com:80"),za=!0),aa.on("connect",function(){}),aa.on("startgame",function(a){ba=a,ba.id!==ca&&(M=ia?ka.attr("src"):null,aa.emit("usersend",{to:ba.opponent,name:la.val(),pic:M,country:0,points:0,rank:0}),ca=ba.id,Ca=!1,null!==ga&&$.mobile.changePage("#title",{transition:"slide",reverse:!0}),D=!1,c(),wa=0,ta=0,xa=[0,0],d(),ga="online","0"===ba.role?(ia?($("#P1icon").attr("src",ka.attr("src")),$("#P1icon2").attr("src",ka.attr("src"))):($("#P1icon").attr("src","Images/player.png"),$("#P1icon2").attr("src","Images/player.png")),N=ja?la.val():navigator.mozL10n.get("lbplayer1"),$("#P2icon").attr("src","Images/online.png"),$("#P2icon2").attr("src","Images/online.png"),O=navigator.mozL10n.get("btonline")):($("#P1icon").attr("src","Images/online.png"),$("#P1icon2").attr("src","Images/online.png"),N=navigator.mozL10n.get("btonline"),ia?($("#P2icon").attr("src",ka.attr("src")),$("#P2icon2").attr("src",ka.attr("src"))):($("#P2icon").attr("src","Images/player.png"),$("#P2icon2").attr("src","Images/player.png")),O=ja?la.val():navigator.mozL10n.get("lbplayer1")),$("#P1name").html(N),$("#P1name2").html(N),$("#P2name").html(O),$("#P2name2").html(O),$.mobile.changePage("#game",{transition:"slide"}))}),aa.on("playget",function(a){Ba===a.round&&Aa!==a.round&&(Aa=a.round,Da=!0,l(a.col))}),aa.on("userget",function(a){"0"===ba.role?(null!==a.pic&&($("#P2icon").attr("src",a.pic),$("#P2icon2").attr("src",a.pic)),a.name.length>0&&(O=a.name,$("#P2name").html(O),$("#P2name2").html(O))):(null!==a.pic&&($("#P1icon").attr("src",a.pic),$("#P1icon2").attr("src",a.pic)),a.name.length>0&&(N=a.name,$("#P1name").html(N),$("#P1name2").html(N)))}),aa.on("quit",function(){ba.id!==da&&(da=ba.id,Ca=!0,$.mobile.changePage("#popupLeft",{transition:"pop",role:"dialog"}))})}function n(){ia?($("#P1icon").attr("src",ka.attr("src")),$("#P1icon2").attr("src",ka.attr("src"))):($("#P1icon").attr("src","Images/player.png"),$("#P1icon2").attr("src","Images/player.png")),N=ja?la.val():navigator.mozL10n.get("lbplayer"),O=navigator.mozL10n.get("lbcomputer"),$("#P1name").html(N),$("#P1name2").html(N),$("#P2name").html(O),$("#P2name2").html(O),$("#P2icon").attr("src","Images/computer.png"),$("#P2icon2").attr("src","Images/computer.png"),d(),Ca=!1,$.mobile.changePage("#game",{transition:"slide"})}function o(){ga="easy",n()}function p(){ga="medium",n()}function q(){ga="hard",n()}function r(){"online"===ga&&(aa.disconnect(),$("#btonline").removeClass("ui-disabled"),$("#btonline2").removeClass("ui-disabled")),Ca=!0,b(),$.mobile.changePage("#title",{transition:"slide",reverse:!0}),D=!1,c(),wa=0,ta=0,xa=[0,0],ga=null}function s(){ha="on"===na.val(),localStorage.setItem("s_sound",na.val()),b(),$.mobile.changePage("#title",{transition:"pop",reverse:!0})}function t(a){"online"===ga?1===ta&&"0"===ba.role||0===ta&&"1"===ba.role||(aa.emit("playsend",{to:ba.opponent,col:a,round:Ba}),l(a)):l(a)}function u(a,b,c){var d,e;for(I=0,J=0,K=0,d=c-3;c>=d;d+=1)if(d>=0&&d+3<H[0].length){for(ya=!0,L=0,e=0;3>=e;e+=1)void 0!==H[b][d+e]&&(H[b][d+e]===a?L+=1:ya=!1);ya&&(I+=1,J+=L,L>K&&(K=L))}for(d=b+3;d>=b;d-=1)if(d-3>=0&&d<H.length){for(ya=!0,L=0,e=0;3>=e;e+=1)void 0!==H[d-e][c]&&(H[d-e][c]===a?L+=1:ya=!1);ya&&(I+=1,J+=L,L>K&&(K=L))}for(d=3;d>=0;d-=1)if(c-d>=0&&c-d+3<H[0].length&&b-d>=0&&b-d+3<H.length){for(ya=!0,L=0,e=0;3>=e;e+=1)void 0!==H[b-d+e][c-d+e]&&(H[b-d+e][c-d+e]===a?L+=1:ya=!1);ya&&(I+=1,J+=L,L>K&&(K=L))}for(d=3;d>=0;d-=1)if(c-d>=0&&c-d+3<H[0].length&&b+d<H.length&&b+d-3>=0){for(ya=!0,L=0,e=0;3>=e;e+=1)void 0!==H[b+d-e][c-d+e]&&(H[b+d-e][c-d+e]===a?L+=1:ya=!1);ya&&(I+=1,J+=L,L>K&&(K=L))}}function v(a,b){return a-b}function w(){var a;for(oa=[],W=!1,S=0;S<H[0].length;S+=1)for(oa[S]=0,T=0;T<H.length;T+=1)if(void 0===H[T][S]){H[T][S]=ta,u(ta,T,S),oa[S]=1e4*K+100*I+J+2,H[T][S]=void 0;break}for(pa[0]=0,a=0;a<oa.length;a+=1)oa[a]>pa[0]&&(pa[0]=oa[a]);for(ta=1-ta,S=0;S<H[0].length;S+=1)for(T=0;T<H.length;T+=1)if(void 0===H[T][S]){H[T][S]=ta,u(ta,T,S),1e4*K+100*I+J+2>pa[0]&&(oa[S]=1e4*K+100*I+J+2),H[T][S]=void 0;break}for(ta=1-ta,ta=1-ta,S=0;S<H[0].length;S+=1){for(T=0;T<H.length-1;T+=1)if(void 0===H[T][S]){H[T+1][S]=ta,j(ta,W),H[T+1][S]=void 0;break}U&&(oa[S]=1,U=!1)}for(ta=1-ta,ta=1-ta,S=0;S<H[0].length;S+=1){for(T=0;T<H.length;T+=1)if(void 0===H[T][S]){H[T][S]=ta,j(ta,W),H[T][S]=void 0;break}U&&(oa[S]=5e4,U=!1)}for(ta=1-ta,S=0;S<H[0].length;S+=1){for(T=0;T<H.length;T+=1)if(void 0===H[T][S]){H[T][S]=ta,j(ta,W),H[T][S]=void 0;break}U&&(oa[S]=6e4,U=!1)}if(pa=oa.slice(),pa.sort(v),pa.reverse(),Q=Math.round(6*Math.random()),"hard"===ga)for(;oa[Q]!==pa[0];)Q=Math.round(6*Math.random());if("medium"===ga)for(;oa[Q]<pa[1]||0===oa[Q];)Q=Math.round(6*Math.random());if("easy"===ga)for(;oa[Q]<pa[2]||0===oa[Q];)Q=Math.round(6*Math.random());l(Q)}function x(){$.mobile.changePage("#game",{transition:"pop",reverse:!0}),"2player"!==ga&&"online"!==ga&&1===ta&&w()}function y(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null!==d?d[1]:!1}function z(a){var b,c=new FileReader,d=document.createElement("canvas"),e=null,f=new Image,g=67,h=71;d.id="hiddenCanvas",d.width=g,d.height=h,d.style.visibility="hidden",document.body.appendChild(d),e=d.getContext("2d"),a.target.files[0].type.match("image.*")?c.readAsDataURL(a.target.files[0]):alert("File is not an image"),c.onload=function(){var a=this.result;b=EXIF.readFromBinaryFile(new BinaryFile(atob(a.split(",")[1]))),f.src=a},f.onload=function(){var a=0,c=0;0===this.width||0===this.height?alert("Image is empty"):((5===b.Orientation||6===b.Orientation)&&(e.rotate(90*Math.PI/180),c=-1*g,g=71,h=67),(3===b.Orientation||4===b.Orientation)&&(e.rotate(180*Math.PI/180),c=-1*g-4,a=-1*h+4),(7===b.Orientation||8===b.Orientation)&&(e.rotate(270*Math.PI/180),a=-1*h,g=71,h=67),e.clearRect(0,0,g,h),e.drawImage(f,0,0,this.width,this.height,a,c,g,h),ka.attr("src",d.toDataURL("image/jpeg")),$("#inputImage_l").attr("src",d.toDataURL("image/jpeg")),localStorage.setItem("s_image",d.toDataURL("image/jpeg")),ia=!0)}}function A(a){""!==a.replace(/\s+/g,"")?(localStorage.setItem("s_name",a),ja=!0):(localStorage.removeItem("s_name"),ja=!1)}function B(){$("#b_imageinput").click()}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var C,D=!1,E=["spalte0","spalte1","spalte2","spalte3","spalte4","spalte5","spalte6"],F=[],G=[],H=[];for(C=0;6>C;C+=1)H[C]=[],H[C][6]=void 0;var I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea=[],fa=[],ga=null,ha=!0,ia=!1,ja=!1,ka=$("#inputImage"),la=$("#inputName"),ma=$("#img_title"),na=$("#b_sound"),oa=[],pa=[],qa=["#ff0080","#6969EE"],ra=["#D6016B","#5A5ACE"],sa=["#FD6BB4","#9393EF"],ta=0,ua=["Images/lightredon.png","Images/lightredoff.png"],va=["Images/lightblueon.png","Images/lightblueoff.png"],wa=0,xa=[0,0],ya=Boolean(!1),za=!1,Aa=null,Ba=0,Ca=!1,Da=!1;window.onload=function(){var a;for(null===localStorage.getItem("s_sound")?na.val("on"):na.val(localStorage.getItem("s_sound")),ha="on"===na.val(),null!==localStorage.getItem("s_image")&&(ka.attr("src",localStorage.getItem("s_image")),$("#inputImage_l").attr("src",localStorage.getItem("s_image")),ia=!0),null!==localStorage.getItem("s_name")&&(la.val(localStorage.getItem("s_name")),""!==localStorage.getItem("s_name").replace(/\s+/g,"")&&(ja=!0)),P=y("theme"),P&&"mi"===P&&(ma.attr("src","Images/title1_mi.png"),$("#popupDialog_t1").attr("src","Images/title1_mi.png"),$("#popupDialog_t2").attr("src","Images/title2_mi.png"),$("#popupInfo_t1").attr("src","Images/title1_mi.png"),$("#popupInfo_t2").attr("src","Images/title2_mi.png"),$("#popupSettings_t1").attr("src","Images/title1_mi.png"),$("#popupSettings_t2").attr("src","Images/title2_mi.png")),$('[id^= "btplay"]').click(function(a){e(),a.preventDefault()}),$('[id^= "btonline"]').click(function(a){m(),a.preventDefault()}),$('[id^= "bteasy"]').click(function(a){o(),a.preventDefault()}),$('[id^= "btmed"]').click(function(a){p(),a.preventDefault()}),$('[id^= "bthard"]').click(function(a){q(),a.preventDefault()}),$(".back").click(function(a){r(),a.preventDefault()}),$(".again").click(function(a){x(),a.preventDefault()}),$(".btimg").click(function(a){B(),a.preventDefault()}),$(".btclose").click(function(a){s(),a.preventDefault()}),$("#inputName").change(function(){A(this.value)}),a=0;a<E.length;a+=1)F[a]=document.getElementById(E[a]),G[a]=F[a].getContext("2d");document.getElementById("spalte0").addEventListener("click",function(){t(0)}),document.getElementById("spalte1").addEventListener("click",function(){t(1)}),document.getElementById("spalte2").addEventListener("click",function(){t(2)}),document.getElementById("spalte3").addEventListener("click",function(){t(3)}),document.getElementById("spalte4").addEventListener("click",function(){t(4)}),document.getElementById("spalte5").addEventListener("click",function(){t(5)}),document.getElementById("spalte6").addEventListener("click",function(){t(6)}),jQuery.preLoadImages(["Images/lightredon.png","Images/lightredoff.png","Images/lightblueon.png","Images/lightblueoff.png","Images/title2eng.png"]),document.getElementById("b_imageinput").addEventListener("change",z,!1),$("#popupSettings_col_b").find("label").attr("style","display:inline;"),b(),ma.delay(1500),ma.fadeOut(1e3),ma.queue(function(){P=y("theme"),P&&"mi"===P?ma.attr("src","Images/title2_mi.png"):ma.attr("src","Images/title2eng.png"),$(this).fadeIn(1e3),$(this).dequeue()})},$(window).resize(function(){b()}),function(a){var b,c,d=[];a.preLoadImages=function(a){var e=a.length-1;for(c=e;c>=0;c-=1)b=document.createElement("img"),b.src=a[c],d.push(b)}}(jQuery),navigator.mozL10n.ready(function(){P=y("lang"),P&&P!==navigator.mozL10n.language.code&&(navigator.mozL10n.language.code=P)})}();